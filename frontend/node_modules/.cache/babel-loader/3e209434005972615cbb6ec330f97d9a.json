{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Camillo\\\\Desktop\\\\pettochat\\\\frontend\\\\src\\\\App.js\",\n    _s = $RefreshSig$();\n\n// React\nimport { useState, useEffect, useRef } from 'react'; // Tailwind\n\nimport './tailwind/tailwind.css';\nimport './tailwind/output.css'; // Socket\n\nimport io from 'socket.io-client'; // Peerjs\n\nimport { Peer } from \"peerjs\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io.connect('http://localhost:5000');\nconsole.log(socket);\n\nfunction App() {\n  _s();\n\n  const [uid, setUid] = useState();\n  const [roomId, setRoomId] = useState();\n  const myVid = useRef();\n  const [myStream, setMyStream] = useState();\n  const usrsVid = [];\n  const socket = io('/');\n  const myPeer = new Peer(undefined, {\n    host: '/',\n    port: '5001'\n  });\n  const peers = {};\n  const [videos, setVideos] = useState([]);\n\n  const addVideoStream = (video, stream) => {\n    video.srcObject = stream;\n    video.addEventListener('loadedmetadata', () => {\n      video.play();\n    });\n    setVideos([...videos, video]);\n    console.log(videos);\n  }; // Init vids\n\n\n  useEffect(() => {\n    const myVideoSource = document.createElement('video');\n    myVideoSource.muted = true;\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      setMyStream(stream);\n      addVideoStream(myVideoSource, stream);\n      myPeer.on('call', call => {\n        call.answer(stream);\n        const video = document.createElement('video');\n        call.on('stream', userVideoStream => {\n          addVideoStream(video, userVideoStream);\n        });\n      });\n    });\n  }, []);\n  useEffect(() => {\n    // get UID and ROOMID\n    if (localStorage.getItem('roomId') != null && localStorage.getItem('uid') != null) {\n      setUid(localStorage.getItem('uid'));\n      setRoomId(localStorage.getItem('roomId'));\n    } else {\n      const getRoom = async () => {\n        await socket.on('get-room', roomId => {\n          console.log('ciao');\n          setRoomId(roomId);\n        });\n        await myPeer.on('open', id => {\n          setUid(id);\n          socket.emit('join-room', roomId, id);\n        });\n      };\n\n      getRoom();\n    }\n\n    if (uid == null || roomId == null) return console.log('Error Room / UID', uid, roomId);\n    console.log(uid, roomId);\n  }, []);\n  useEffect(() => {\n    const videosDisplayed = document.getElementsByTagName('video');\n    let c = 0;\n\n    for (const vid of videosDisplayed) {\n      console.log('update videos');\n      console.log(videos[c].srcObject);\n      vid.srcObject = videos[c].srcObject;\n      c += 1;\n    }\n  }, [videos]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-full flex items-center justify-center\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"video-grid\",\n      className: \"grid grid-cols-2 gap-4\",\n      children: videos.map(v => /*#__PURE__*/_jsxDEV(\"video\", {}, v.srcObject.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 35\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 9\n  }, this);\n}\n\n_s(App, \"1k8F0DQNb/Do+YpCAn/oQyiFaZk=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["useState","useEffect","useRef","io","Peer","socket","connect","console","log","App","uid","setUid","roomId","setRoomId","myVid","myStream","setMyStream","usrsVid","myPeer","undefined","host","port","peers","videos","setVideos","addVideoStream","video","stream","srcObject","addEventListener","play","myVideoSource","document","createElement","muted","navigator","mediaDevices","getUserMedia","audio","then","on","call","answer","userVideoStream","localStorage","getItem","getRoom","id","emit","videosDisplayed","getElementsByTagName","c","vid","map","v"],"sources":["C:/Users/Camillo/Desktop/pettochat/frontend/src/App.js"],"sourcesContent":["// React\r\nimport { useState, useEffect, useRef } from 'react'\r\n\r\n// Tailwind\r\nimport './tailwind/tailwind.css'\r\nimport './tailwind/output.css'\r\n\r\n// Socket\r\nimport io from 'socket.io-client'\r\n\r\n// Peerjs\r\nimport { Peer } from \"peerjs\";\r\n\r\nconst socket = io.connect('http://localhost:5000')\r\nconsole.log(socket)\r\n\r\nfunction App() {\r\n\r\n    const [uid, setUid] = useState()\r\n    const [roomId, setRoomId] = useState()\r\n\r\n    const myVid = useRef()\r\n    const [myStream, setMyStream] = useState()\r\n\r\n    const usrsVid = []\r\n\r\n    const socket = io('/')\r\n    const myPeer = new Peer(undefined, {\r\n        host: '/',\r\n        port: '5001'\r\n    })\r\n\r\n    const peers = {}\r\n    const [videos, setVideos] = useState([])\r\n\r\n    const addVideoStream = (video, stream) => {\r\n        video.srcObject = stream\r\n        video.addEventListener('loadedmetadata', () => {\r\n            video.play()\r\n        })\r\n        setVideos([...videos, video])\r\n        console.log(videos)\r\n    }\r\n\r\n    // Init vids\r\n    useEffect(() => {\r\n        const myVideoSource = document.createElement('video')\r\n        myVideoSource.muted = true\r\n        navigator.mediaDevices.getUserMedia({\r\n            video: true,\r\n            audio: true\r\n        }).then(stream => {\r\n            setMyStream(stream)\r\n            addVideoStream(myVideoSource, stream)\r\n\r\n            myPeer.on('call', call => {\r\n                call.answer(stream)\r\n                const video = document.createElement('video')\r\n                call.on('stream', userVideoStream => {\r\n                    addVideoStream(video, userVideoStream)\r\n                })\r\n            })\r\n        })\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        // get UID and ROOMID\r\n        if (localStorage.getItem('roomId') != null && localStorage.getItem('uid') != null) {\r\n            setUid(localStorage.getItem('uid'));\r\n            setRoomId(localStorage.getItem('roomId'))\r\n        } else {\r\n            const getRoom = async () => {\r\n                await socket.on('get-room', roomId => {\r\n                    console.log('ciao')\r\n                    setRoomId(roomId)\r\n                })\r\n                await myPeer.on('open', id => {\r\n                    setUid(id)\r\n                    socket.emit('join-room', roomId, id)\r\n                })\r\n            }\r\n            getRoom()\r\n        }\r\n\r\n        if (uid == null || roomId == null) return console.log('Error Room / UID', uid, roomId)\r\n\r\n        console.log(uid, roomId)\r\n\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        const videosDisplayed = document.getElementsByTagName('video')\r\n        let c = 0\r\n        for (const vid of videosDisplayed) {\r\n            console.log('update videos')\r\n            console.log(videos[c].srcObject)\r\n            vid.srcObject = videos[c].srcObject\r\n            c += 1\r\n        }\r\n    }, [videos])\r\n\r\n    return (\r\n        <div className='h-full flex items-center justify-center'>\r\n            <div id=\"video-grid\" className='grid grid-cols-2 gap-4'>\r\n                { videos.map(v => <video key={ v.srcObject.id }></video>) }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}